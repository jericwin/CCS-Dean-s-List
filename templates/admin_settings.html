<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Settings</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='logo.png') }}"
      type="image/png"
    />

    <style>
      :root {
        --primary: #ff7a1a;
        --primary-hover: #e06b17;
        --secondary: #7b1f1f;
        --bg-dark: #121212;
        --bg-card: #1e1e1e;
        --text-main: #e0e0e0;
        --text-muted: #a0a0a0;
        --border-color: #333;
        --sidebar-width: 260px;
        --transition: all 0.3s ease;

        /* Legacy variables mapped */
        --maroon: var(--secondary);
        --orange: var(--primary);
        --dark-bg: var(--bg-dark);
        --card-bg: #2c2c2c;
        --grey: #6b6b6b;
        --text-light: var(--text-main);
        --dark-gray: var(--bg-dark);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", sans-serif;
        display: flex;
        background-color: var(--bg-dark);
        color: var(--text-main);
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: var(--sidebar-width);
        background-color: var(--bg-card);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        padding: 2rem 1.5rem;
        position: fixed;
        height: 100vh;
        z-index: 100;
      }

      .sidebar-header {
        margin-bottom: 3rem;
        text-align: center;
      }

      .sidebar-header h2 {
        color: var(--primary);
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: 0.5px;
      }

      .nav-links {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        flex: 1;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.8rem 1rem;
        color: var(--text-muted);
        text-decoration: none;
        border-radius: 8px;
        transition: var(--transition);
        font-weight: 500;
      }

      .nav-link:hover,
      .nav-link.active {
        background-color: rgba(255, 122, 26, 0.1);
        color: var(--primary);
      }

      .nav-link i {
        width: 20px;
        text-align: center;
      }

      /* User Menu */
      .user-menu {
        margin-top: auto;
        position: relative;
      }

      .user-btn {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        padding: 0.8rem 1rem;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-main);
        cursor: pointer;
        transition: var(--transition);
      }

      .user-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .dropdown-menu {
        position: absolute;
        bottom: 110%;
        left: 0;
        width: 100%;
        background-color: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 0.5rem;
        display: none;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .dropdown-menu.show {
        display: block;
        animation: slideUp 0.2s ease;
      }

      .dropdown-item {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        padding: 0.8rem 1rem;
        color: var(--text-muted);
        text-decoration: none;
        border-radius: 6px;
        transition: var(--transition);
      }

      .dropdown-item:hover {
        background-color: rgba(255, 255, 255, 0.05);
        color: var(--text-main);
      }

      .dropdown-item.danger {
        color: #ff4d4d;
      }

      .dropdown-item.danger:hover {
        background-color: rgba(255, 77, 77, 0.1);
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Content */
      .content {
        margin-left: 250px;
        padding: 40px;
        flex: 1;
        animation: fadeIn 0.8s ease forwards;
      }
      .content h1 {
        color: var(--orange);
        margin-bottom: 25px;
      }

      /* Form Fields */
      .form-card {
        background: var(--card-bg);
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      }
      .form-card input,
      .form-card textarea {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid var(--grey);
        background: var(--card-bg);
        color: #fff;
      }
      .form-card input[type="submit"] {
        background: var(--orange);
        border: none;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      .form-card input[type="submit"]:hover {
        background: #e96a10;
      }

      /* User menu container at bottom of sidebar */
      .user-menu {
        margin-top: auto;
        position: relative; /* anchor for dropdown positioning */
      }

      /* The clickable icon (admin name + caret) */
      .user-icon {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--grey);
        padding: 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }
      .user-icon:hover {
        background: var(--orange);
        color: white;
      }

      /* Dropdown container (hidden by default) */
      .dropdown {
        display: none;
        position: absolute;
        bottom: 60px; /* distance above the user icon */
        right: 0; /* align with right edge */
        background: var(--card-bg);
        border-radius: 10px;
        width: 180px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        overflow: hidden;
        transform-origin: bottom;
        transform: scaleY(0);
        transition: transform 0.3s ease;
        z-index: 100;
      }

      /* Show dropdown when toggled */
      .dropdown.show {
        display: block;
        transform: scaleY(1);
      }

      /* Dropdown links */
      .dropdown a {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        color: var(--text-light);
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
      }
      .dropdown a:hover {
        background: var(--orange);
        color: white;
      }

      /* Specific style for logout to make it stand out */
      .dropdown a:last-child {
        border-top: 1px solid var(--grey);
        font-weight: 600;
        color: #ff4d4d;
      }
      .dropdown a:last-child:hover {
        background: #ff4d4d;
        color: #fff;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media screen and (max-width: 768px) {
        .sidebar {
          width: 200px;
        }
        .content {
          margin-left: 200px;
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>ADMIN PANEL</h2>
      </div>
      <div class="nav-links">
        <a href="{{ url_for('admin_dashboard') }}" class="nav-link">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="{{ url_for('admin_announcements') }}" class="nav-link">
          <i class="fas fa-bullhorn"></i>
          <span>Announcements</span>
        </a>
        <a
          href="{{ url_for('admin_deans_list_applications') }}"
          class="nav-link"
        >
          <i class="fas fa-award"></i>
          <span>Dean's List</span>
        </a>
        <a href="{{ url_for('admin_chat') }}" class="nav-link">
          <i class="fas fa-comments"></i>
          <span>Chat Support</span>
        </a>
        <a href="{{ url_for('admin_feedback') }}" class="nav-link">
          <i class="fas fa-comment-dots"></i>
          <span>Feedback</span>
        </a>
        <a href="{{ url_for('admin_ranking') }}" class="nav-link">
          <i class="fas fa-trophy"></i>
          <span>Ranking</span>
        </a>
      </div>
      <div class="user-menu">
        <div class="user-btn" onclick="toggleUserMenu()">
          <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span>Admin</span>
          </div>
          <i class="fas fa-chevron-up"></i>
        </div>
        <div class="dropdown-menu" id="userDropdown">
          <a href="{{ url_for('admin_settings') }}" class="dropdown-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
          <a href="{{ url_for('admin_logout') }}" class="dropdown-item danger">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </div>
      </div>
    </div>

    <script>
      function toggleUserMenu() {
        const menu = document.getElementById("userDropdown");
        menu.classList.toggle("show");
      }

      // Close dropdown when clicking outside
      window.addEventListener("click", function (e) {
        const userBtn = document.querySelector(".user-btn");
        const menu = document.getElementById("userDropdown");

        if (!userBtn.contains(e.target) && !menu.contains(e.target)) {
          menu.classList.remove("show");
        }
      });
    </script>

    <!-- Content -->
    <div class="content">
      <h1>Admin Settings</h1>

      <!-- Settings Form -->
      <div class="form-card">
        <h3>Change Password</h3>
        <form action="/admin/settings" method="POST">
          <input
            type="password"
            name="current_password"
            placeholder="Current Password"
            required
          />
          <input
            type="password"
            name="new_password"
            placeholder="New Password"
            required
          />
          <input
            type="password"
            name="confirm_password"
            placeholder="Confirm New Password"
            required
          />
          <input type="submit" value="Update Password" />
        </form>
      </div>

      <!-- Update Admin Info Form -->
      <div class="form-card">
        <h3>Update Admin Information</h3>
        <form action="/admin/settings" method="POST">
          <input
            type="text"
            name="first_name"
            placeholder="First Name"
            required
          />
          <input
            type="text"
            name="last_name"
            placeholder="Last Name"
            required
          />
          <input
            type="email"
            name="email"
            placeholder="Email Address"
            required
          />
          <input type="submit" value="Update Information" />
        </form>
      </div>
    </div>

    <script>
      // Dropdown toggle
      const userIcon = document.getElementById("userIcon");
      const userDropdown = document.getElementById("userDropdown");

      // Toggle dropdown on click
      userIcon.addEventListener("click", (e) => {
        e.stopPropagation(); // prevent window click from firing immediately
        userDropdown.classList.toggle("show");
      });

      // Close dropdown if clicking outside
      window.addEventListener("click", (e) => {
        if (!userIcon.contains(e.target)) {
          userDropdown.classList.remove("show");
        }
      });

      // Add logout confirmation
      const logoutLink = document.querySelector('.dropdown a[href*="logout"]');
      if (logoutLink) {
        logoutLink.addEventListener("click", (e) => {
          const confirmLogout = confirm("Are you sure you want to logout?");
          if (!confirmLogout) {
            e.preventDefault();
          }
        });
      }
    </script>
  </body>
</html>
