<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='logo.png') }}"
      type="image/png"
    />
    <title>Dean's Applications</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      :root {
        --primary: #ff7a1a;
        --primary-hover: #e06b17;
        --secondary: #7b1f1f;
        --bg-dark: #121212;
        --bg-card: #1e1e1e;
        --text-main: #e0e0e0;
        --text-muted: #a0a0a0;
        --border-color: #333;
        --sidebar-width: 260px;
        --transition: all 0.3s ease;

        --maroon: var(--secondary);
        --orange: var(--primary);
        --grey: #6b6b6b;
        --light-grey: #f3f3f3;
        --dark-bg: var(--bg-dark);
        --card-bg: #2c2c2c;
        --text-light: var(--text-main);
        --dark-gray: var(--bg-dark);
        --success: #28a745;
        --danger: #dc3545;
        --warning: #ffc107;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--bg-dark);
        color: var(--text-main);
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: var(--sidebar-width);
        background-color: var(--bg-card);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        padding: 2rem 1.5rem;
        position: fixed;
        height: 100vh;
        z-index: 100;
      }

      .sidebar-header {
        margin-bottom: 3rem;
        text-align: center;
      }

      .sidebar-header h2 {
        color: var(--primary);
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: 0.5px;
      }

      .nav-links {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        flex: 1;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.8rem 1rem;
        color: var(--text-muted);
        text-decoration: none;
        border-radius: 8px;
        transition: var(--transition);
        font-weight: 500;
      }

      .nav-link:hover,
      .nav-link.active {
        background-color: rgba(255, 122, 26, 0.1);
        color: var(--primary);
      }

      .nav-link i {
        width: 20px;
        text-align: center;
      }

      /* User Menu */
      .user-menu {
        margin-top: auto;
        position: relative;
      }

      .user-btn {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        padding: 0.8rem 1rem;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-main);
        cursor: pointer;
        transition: var(--transition);
      }

      .user-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .dropdown-menu {
        position: absolute;
        bottom: 110%;
        left: 0;
        width: 100%;
        background-color: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 0.5rem;
        display: none;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .dropdown-menu.show {
        display: block;
        animation: slideUp 0.2s ease;
      }

      .dropdown-item {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        padding: 0.8rem 1rem;
        color: var(--text-muted);
        text-decoration: none;
        border-radius: 6px;
        transition: var(--transition);
      }

      .dropdown-item:hover {
        background-color: rgba(255, 255, 255, 0.05);
        color: var(--text-main);
      }

      .dropdown-item.danger {
        color: #ff4d4d;
      }

      .dropdown-item.danger:hover {
        background-color: rgba(255, 77, 77, 0.1);
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Content */
      .content {
        margin-left: 250px;
        padding: 40px;
        flex: 1;
        width: calc(100% - 250px);
      }
      .header-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }
      .header-section h2 {
        color: var(--orange);
        font-size: 28px;
      }

      /* Filter Bar */
      .filter-bar {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 12px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }
      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
        flex: 1;
        min-width: 150px;
      }
      .filter-group label {
        font-size: 12px;
        color: #aaa;
        font-weight: 600;
      }
      .filter-input,
      .filter-select {
        padding: 10px 15px;
        background: #3a3a3a;
        border: 1px solid #555;
        border-radius: 8px;
        color: white;
        font-size: 14px;
        outline: none;
        transition: border-color 0.3s;
      }
      .filter-input:focus,
      .filter-select:focus {
        border-color: var(--orange);
      }

      /* Table Styles */
      .table-container {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        overflow-x: auto;
      }
      .data-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      .data-table th,
      .data-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #444;
      }
      .data-table th {
        color: var(--orange);
        font-weight: 600;
        cursor: pointer;
        user-select: none;
        white-space: nowrap;
      }
      .data-table th:hover {
        color: #fff;
      }
      .data-table th i {
        margin-left: 5px;
        font-size: 12px;
        color: #666;
      }
      .data-table tbody tr {
        transition: background 0.2s;
      }
      .data-table tbody tr:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      .data-table tbody tr:last-child td {
        border-bottom: none;
      }

      /* Status Badges */
      .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .status-badge.pending {
        background: rgba(255, 193, 7, 0.2);
        color: var(--warning);
      }
      .status-badge.approved {
        background: rgba(40, 167, 69, 0.2);
        color: var(--success);
      }
      .status-badge.rejected {
        background: rgba(220, 53, 69, 0.2);
        color: var(--danger);
      }
      .status-badge.for-dean-review {
        background: rgba(23, 162, 184, 0.2);
        color: #17a2b8;
      }
      .status-badge.dean-approved {
        background: rgba(40, 167, 69, 0.2);
        color: var(--success);
      }
      .status-badge.dean-rejected {
        background: rgba(220, 53, 69, 0.2);
        color: var(--danger);
      }

      /* Action Button */
      .btn-action {
        background: var(--orange);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn-action:hover {
        background: #e96a10;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        justify-content: center;
        align-items: center;
      }
      .modal.show {
        display: flex;
        animation: fadeIn 0.3s ease;
      }
      .modal-content {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 15px;
        width: 500px;
        max-width: 90%;
        position: relative;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        border: 1px solid #444;
      }
      .close-modal {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 24px;
        color: #aaa;
        cursor: pointer;
        transition: color 0.3s;
      }
      .close-modal:hover {
        color: white;
      }

      .modal-header {
        margin-bottom: 20px;
        border-bottom: 1px solid #444;
        padding-bottom: 15px;
      }
      .modal-header h3 {
        color: var(--orange);
      }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
      }
      .info-item label {
        display: block;
        font-size: 12px;
        color: #aaa;
        margin-bottom: 4px;
      }
      .info-item p {
        font-weight: 600;
        font-size: 14px;
      }

      .file-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      .file-btn {
        flex: 1;
        padding: 10px;
        background: #3a3a3a;
        color: white;
        text-decoration: none;
        text-align: center;
        border-radius: 6px;
        font-size: 13px;
        transition: background 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      .file-btn:hover {
        background: #555;
      }

      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-size: 13px;
        color: #ccc;
      }
      .form-control {
        width: 100%;
        padding: 10px;
        background: #1e1e1e;
        border: 1px solid #444;
        border-radius: 6px;
        color: white;
        font-family: inherit;
      }
      .form-control:focus {
        border-color: var(--orange);
        outline: none;
      }
      textarea.form-control {
        resize: vertical;
        min-height: 80px;
      }

      .modal-footer {
        margin-top: 20px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      .btn-secondary {
        background: #555;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
      }
      .btn-primary {
        background: var(--orange);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
      }
      .btn-primary:hover {
        background: #e96a10;
      }

      /* User Menu */
      .user-menu {
        margin-top: auto;
        position: relative;
      }
      .user-icon {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #333;
        padding: 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }
      .user-icon:hover {
        background: var(--orange);
        color: white;
      }
      .dropdown {
        display: none;
        position: absolute;
        bottom: 60px;
        right: 0;
        background: var(--card-bg);
        border-radius: 10px;
        width: 180px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        overflow: hidden;
        z-index: 100;
        border: 1px solid #444;
      }
      .dropdown.show {
        display: block;
      }
      .dropdown a {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        color: var(--text-light);
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
        margin: 0;
        border-radius: 0;
      }
      .dropdown a:hover {
        background: var(--orange);
        color: white;
        transform: none;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>DEAN PANEL</h2>
      </div>
      <div class="nav-links">
        <a href="{{ url_for('dean_dashboard') }}" class="nav-link">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="{{ url_for('dean_applications') }}" class="nav-link active">
          <i class="fas fa-list-alt"></i>
          <span>Applications</span>
        </a>
      </div>
      <div class="user-menu">
        <div class="user-btn" onclick="toggleUserMenu()">
          <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span>{{ first_name }}</span>
          </div>
          <i class="fas fa-chevron-up"></i>
        </div>
        <div class="dropdown-menu" id="userDropdown">
          <a href="{{ url_for('dean_logout') }}" class="dropdown-item danger">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="content">
      <div class="header-section">
        <h2>Dean's List Applications Review</h2>
      </div>

      <!-- Filter Bar -->
      <div class="filter-bar">
        <div class="filter-group">
          <label>Search Student</label>
          <input
            type="text"
            id="searchInput"
            class="filter-input"
            placeholder="Search by name..."
            onkeyup="filterTable()"
          />
        </div>
        <div class="filter-group">
          <label>Status</label>
          <select
            id="statusFilter"
            class="filter-select"
            onchange="filterTable()"
          >
            <option value="all">All Statuses</option>
            <option value="for dean review">For Dean Review</option>
            <option value="dean approved">Dean Approved</option>
            <option value="dean rejected">Dean Rejected</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Program</label>
          <select
            id="programFilter"
            class="filter-select"
            onchange="filterTable()"
          >
            <option value="all">All Programs</option>
            <option value="bsit">BSIT</option>
            <option value="bscs">BSCS</option>
            <option value="bsis">BSIS</option>
          </select>
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <table class="data-table" id="applicationsTable">
          <thead>
            <tr>
              <th onclick="sortTable(0)">
                Student Name <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable(1)">Course <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(2)">
                Year/Sem <i class="fas fa-sort"></i>
              </th>
              <th onclick="sortTable(3)">GWA <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(4)">Status <i class="fas fa-sort"></i></th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for app in applications %}
            <tr
              class="app-row"
              data-status="{{ app.status|lower }}"
              data-course="{{ app.course|lower }}"
              data-year="{{ app.academic_year }}"
              data-sem="{{ app.semester }}"
            >
              <td>{{ app.full_name }}</td>
              <td>{{ app.course }}</td>
              <td>{{ app.academic_year }} - {{ app.semester }}</td>
              <td>{{ app.gwa }}</td>
              <td>
                <span
                  class="status-badge {{ app.status|lower|replace(' ', '-') }}"
                  >{{ app.status }}</span
                >
              </td>
              <td>
                <button
                  class="btn-action"
                  data-id="{{ app.id }}"
                  data-name="{{ app.full_name }}"
                  data-course="{{ app.course }}"
                  data-year="{{ app.academic_year }}"
                  data-sem="{{ app.semester }}"
                  data-status="{{ app.status }}"
                  data-gwa="{{ app.gwa }}"
                  data-comment="{{ app.admin_comment }}"
                  data-cog-url="{{ url_for('static', filename='uploads/' + app.cog_filename) }}"
                  data-coe-url="{{ url_for('static', filename='uploads/' + app.coe_filename) }}"
                  onclick="openModal(this)"
                >
                  <i class="fas fa-edit"></i> Review
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal -->
    <div id="reviewModal" class="modal">
      <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div class="modal-header">
          <h3>Review Application</h3>
        </div>

        <div class="info-grid">
          <div class="info-item">
            <label>Student Name</label>
            <p id="modalName">John Doe</p>
          </div>
          <div class="info-item">
            <label>Course</label>
            <p id="modalCourse">BSIT 3A</p>
          </div>
          <div class="info-item">
            <label>Academic Year</label>
            <p id="modalYear">2024-2025</p>
          </div>
          <div class="info-item">
            <label>Semester</label>
            <p id="modalSem">1st Semester</p>
          </div>
        </div>

        <div class="file-actions">
          <a href="#" id="linkCOG" target="_blank" class="file-btn"
            ><i class="fas fa-file-alt"></i> View COG</a
          >
          <a href="#" id="linkCOE" target="_blank" class="file-btn"
            ><i class="fas fa-file-alt"></i> View COE</a
          >
        </div>

        <form method="POST" id="updateForm">
          <input type="hidden" name="app_id" id="modalAppId" />

          <div class="form-group">
            <label>Status</label>
            <select name="status" id="modalStatus" class="form-control">
              <option value="For Dean Review">For Dean Review</option>
              <option value="Dean Approved">Approve</option>
              <option value="Dean Rejected">Reject</option>
            </select>
          </div>

          <div class="form-group">
            <label>Dean Comment</label>
            <textarea
              name="comment"
              id="modalComment"
              class="form-control"
              placeholder="Add a comment..."
            ></textarea>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn-secondary" onclick="closeModal()">
              Cancel
            </button>
            <button type="submit" class="btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // =======================
      // Modal Functions
      // =======================
      const modal = document.getElementById("reviewModal");
      const updateForm = document.getElementById("updateForm");

      function openModal(btn) {
        // Populate Modal Data
        document.getElementById("modalName").textContent = btn.dataset.name;
        document.getElementById("modalCourse").textContent = btn.dataset.course;
        document.getElementById("modalYear").textContent = btn.dataset.year;
        document.getElementById("modalSem").textContent = btn.dataset.sem;

        // Populate Form Fields
        document.getElementById("modalAppId").value = btn.dataset.id;
        document.getElementById("modalStatus").value = btn.dataset.status;
        document.getElementById("modalComment").value =
          btn.dataset.comment === "None" ? "" : btn.dataset.comment;

        // Update File Links
        const linkCOG = document.getElementById("linkCOG");
        const linkCOE = document.getElementById("linkCOE");

        linkCOG.href = btn.dataset.cogUrl;
        linkCOE.href = btn.dataset.coeUrl;

        // Show Modal
        modal.classList.add("show");
      }

      function closeModal() {
        modal.classList.remove("show");
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        if (event.target == modal) {
          closeModal();
        }
      };

      // =======================
      // Filter Functions
      // =======================
      function filterTable() {
        const searchInput = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const statusFilter = document
          .getElementById("statusFilter")
          .value.toLowerCase();
        const programFilter = document
          .getElementById("programFilter")
          .value.toLowerCase();

        const rows = document.querySelectorAll(".app-row");

        rows.forEach((row) => {
          const name = row.cells[0].textContent.toLowerCase();
          const status = row.dataset.status;
          const course = row.dataset.course;

          // Determine program from course
          let program = "other";
          if (course.startsWith("bsit")) program = "bsit";
          else if (course.startsWith("bscs")) program = "bscs";
          else if (course.startsWith("bsis")) program = "bsis";

          let show = true;

          if (searchInput && !name.includes(searchInput)) show = false;
          if (statusFilter !== "all" && status !== statusFilter) show = false;
          if (programFilter !== "all" && program !== programFilter)
            show = false;

          row.style.display = show ? "" : "none";
        });
      }

      // =======================
      // Sort Functions
      // =======================
      function sortTable(n) {
        const table = document.getElementById("applicationsTable");
        let rows,
          switching,
          i,
          x,
          y,
          shouldSwitch,
          dir,
          switchcount = 0;
        switching = true;
        dir = "asc";

        while (switching) {
          switching = false;
          rows = table.rows;

          for (i = 1; i < rows.length - 1; i++) {
            shouldSwitch = false;
            x = rows[i].getElementsByTagName("TD")[n];
            y = rows[i + 1].getElementsByTagName("TD")[n];

            if (dir == "asc") {
              if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                shouldSwitch = true;
                break;
              }
            } else if (dir == "desc") {
              if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                shouldSwitch = true;
                break;
              }
            }
          }

          if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
            switchcount++;
          } else {
            if (switchcount == 0 && dir == "asc") {
              dir = "desc";
              switching = true;
            }
          }
        }
      }

      // =======================
      // User Menu & Logout
      // =======================
      const userIcon = document.getElementById("userIcon");
      const userDropdown = document.getElementById("userDropdown");

      if (userIcon) {
        userIcon.addEventListener("click", (e) => {
          e.stopPropagation();
          userDropdown.classList.toggle("show");
        });
      }

      window.addEventListener("click", () => {
        if (userDropdown && userDropdown.classList.contains("show")) {
          userDropdown.classList.remove("show");
        }
      });

      // User menu script for new sidebar
      function toggleUserMenu() {
        const menu = document.getElementById("userDropdown");
        menu.classList.toggle("show");
      }

      // Close dropdown when clicking outside
      window.addEventListener("click", function (e) {
        const userBtn = document.querySelector(".user-btn");
        const menu = document.getElementById("userDropdown");

        if (!userBtn.contains(e.target) && !menu.contains(e.target)) {
          menu.classList.remove("show");
        }
      });

      // Logout confirmation
      const logoutLink = document.querySelector(".dropdown-item.danger");
      if (logoutLink) {
        logoutLink.addEventListener("click", (e) => {
          if (!confirm("Are you sure you want to logout?")) {
            e.preventDefault();
          }
        });
      }
    </script>
  </body>
</html>
